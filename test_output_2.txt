=== RUN   TestE2E_HTTP_Flow
=== RUN   TestE2E_HTTP_Flow/HealthCheck
=== RUN   TestE2E_HTTP_Flow/AuthMiddleware
{"level":"error","time":"2026-01-13T20:08:31.094+0100","caller":"server/router.go:279","msg":"Missing authorization token","stacktrace":"mqueue/internal/server.SetupRouter.func2.authMiddleware.8.1\n\t/home/morah-paul/Desktop/mqueue/internal/server/router.go:279\nnet/http.HandlerFunc.ServeHTTP\n\t/home/morah-paul/go/pkg/mod/golang.org/toolchain@v0.0.1-go1.24.9.linux-amd64/src/net/http/server.go:2294\ngithub.com/go-chi/chi/v5.(*ChainHandler).ServeHTTP\n\t/home/morah-paul/go/pkg/mod/github.com/go-chi/chi/v5@v5.0.7/chain.go:31\ngithub.com/go-chi/chi/v5.(*Mux).routeHTTP\n\t/home/morah-paul/go/pkg/mod/github.com/go-chi/chi/v5@v5.0.7/mux.go:442\nnet/http.HandlerFunc.ServeHTTP\n\t/home/morah-paul/go/pkg/mod/golang.org/toolchain@v0.0.1-go1.24.9.linux-amd64/src/net/http/server.go:2294\ngithub.com/go-chi/httprate.(*RateLimiter).Handler-fm.(*RateLimiter).Handler.func1\n\t/home/morah-paul/go/pkg/mod/github.com/go-chi/httprate@v0.15.0/limiter.go:148\nnet/http.HandlerFunc.ServeHTTP\n\t/home/morah-paul/go/pkg/mod/golang.org/toolchain@v0.0.1-go1.24.9.linux-amd64/src/net/http/server.go:2294\ngithub.com/go-chi/chi/v5.(*Mux).ServeHTTP\n\t/home/morah-paul/go/pkg/mod/github.com/go-chi/chi/v5@v5.0.7/mux.go:88\nnet/http.serverHandler.ServeHTTP\n\t/home/morah-paul/go/pkg/mod/golang.org/toolchain@v0.0.1-go1.24.9.linux-amd64/src/net/http/server.go:3301\nnet/http.(*conn).serve\n\t/home/morah-paul/go/pkg/mod/golang.org/toolchain@v0.0.1-go1.24.9.linux-amd64/src/net/http/server.go:2102"}
{"level":"error","time":"2026-01-13T20:08:31.095+0100","caller":"server/router.go:293","msg":"Invalid JWT token{error 26 0  token contains an invalid number of segments}","stacktrace":"mqueue/internal/server.SetupRouter.func2.authMiddleware.8.1\n\t/home/morah-paul/Desktop/mqueue/internal/server/router.go:293\nnet/http.HandlerFunc.ServeHTTP\n\t/home/morah-paul/go/pkg/mod/golang.org/toolchain@v0.0.1-go1.24.9.linux-amd64/src/net/http/server.go:2294\ngithub.com/go-chi/chi/v5.(*ChainHandler).ServeHTTP\n\t/home/morah-paul/go/pkg/mod/github.com/go-chi/chi/v5@v5.0.7/chain.go:31\ngithub.com/go-chi/chi/v5.(*Mux).routeHTTP\n\t/home/morah-paul/go/pkg/mod/github.com/go-chi/chi/v5@v5.0.7/mux.go:442\nnet/http.HandlerFunc.ServeHTTP\n\t/home/morah-paul/go/pkg/mod/golang.org/toolchain@v0.0.1-go1.24.9.linux-amd64/src/net/http/server.go:2294\ngithub.com/go-chi/httprate.(*RateLimiter).Handler-fm.(*RateLimiter).Handler.func1\n\t/home/morah-paul/go/pkg/mod/github.com/go-chi/httprate@v0.15.0/limiter.go:148\nnet/http.HandlerFunc.ServeHTTP\n\t/home/morah-paul/go/pkg/mod/golang.org/toolchain@v0.0.1-go1.24.9.linux-amd64/src/net/http/server.go:2294\ngithub.com/go-chi/chi/v5.(*Mux).ServeHTTP\n\t/home/morah-paul/go/pkg/mod/github.com/go-chi/chi/v5@v5.0.7/mux.go:88\nnet/http.serverHandler.ServeHTTP\n\t/home/morah-paul/go/pkg/mod/golang.org/toolchain@v0.0.1-go1.24.9.linux-amd64/src/net/http/server.go:3301\nnet/http.(*conn).serve\n\t/home/morah-paul/go/pkg/mod/golang.org/toolchain@v0.0.1-go1.24.9.linux-amd64/src/net/http/server.go:2102"}
=== RUN   TestE2E_HTTP_Flow/EnqueueAndDequeue
{"level":"info","time":"2026-01-13T20:08:31.096+0100","caller":"server/router.go:112","msg":"Enqueued items{count 11 1  <nil>} {duration 8 523431  <nil>}"}
{"level":"info","time":"2026-01-13T20:08:31.212+0100","caller":"flusher/flusher.go:103","msg":"Flushed items{count 11 1  <nil>}"}
{"level":"info","time":"2026-01-13T20:08:36.098+0100","caller":"server/router.go:174","msg":"Dequeued items{count 11 1  <nil>} {duration 8 514423  <nil>}"}
{"level":"info","time":"2026-01-13T20:08:36.109+0100","caller":"server/router.go:195","msg":"Acknowledged item{id 11 269543218222202880  <nil>} {duration 8 10679703  <nil>}"}
=== RUN   TestE2E_HTTP_Flow/DLQ_Flow
{"level":"info","time":"2026-01-13T20:08:36.110+0100","caller":"server/router.go:112","msg":"Enqueued items{count 11 1  <nil>} {duration 8 498130  <nil>}"}
{"level":"info","time":"2026-01-13T20:08:36.206+0100","caller":"flusher/flusher.go:103","msg":"Flushed items{count 11 1  <nil>}"}
{"level":"info","time":"2026-01-13T20:08:37.113+0100","caller":"server/router.go:174","msg":"Dequeued items{count 11 1  <nil>} {duration 8 785038  <nil>}"}
{"level":"info","time":"2026-01-13T20:08:37.128+0100","caller":"retry/retry_manager.go:69","msg":"Retried item{id 11 269542413595312128  <nil>} {retries 11 1  <nil>} {backoff 8 0  <nil>}"}
{"level":"info","time":"2026-01-13T20:08:37.128+0100","caller":"server/router.go:224","msg":"Negatively acknowledged item{id 11 269542413595312128  <nil>} {duration 8 12665131  <nil>}"}
{"level":"info","time":"2026-01-13T20:08:37.131+0100","caller":"server/router.go:174","msg":"Dequeued items{count 11 1  <nil>} {duration 8 887692  <nil>}"}
{"level":"info","time":"2026-01-13T20:08:37.136+0100","caller":"retry/retry_manager.go:69","msg":"Retried item{id 11 269542009079857152  <nil>} {retries 11 1  <nil>} {backoff 8 0  <nil>}"}
{"level":"info","time":"2026-01-13T20:08:37.136+0100","caller":"server/router.go:224","msg":"Negatively acknowledged item{id 11 269542009079857152  <nil>} {duration 8 4123308  <nil>}"}
{"level":"info","time":"2026-01-13T20:08:37.138+0100","caller":"server/router.go:174","msg":"Dequeued items{count 11 1  <nil>} {duration 8 704729  <nil>}"}
{"level":"info","time":"2026-01-13T20:08:37.143+0100","caller":"retry/retry_manager.go:69","msg":"Retried item{id 11 269542413595312128  <nil>} {retries 11 1  <nil>} {backoff 8 0  <nil>}"}
{"level":"info","time":"2026-01-13T20:08:37.143+0100","caller":"server/router.go:224","msg":"Negatively acknowledged item{id 11 269542413595312128  <nil>} {duration 8 4297437  <nil>}"}
    e2e_test.go:335: Item not found in DLQ after max retries
{"level":"info","time":"2026-01-13T20:08:37.157+0100","caller":"flusher/flusher.go:50","msg":"Flusher shutting down, performing final flush..."}
{"level":"info","time":"2026-01-13T20:08:37.157+0100","caller":"prefetch/redis_prefetch.go:50","msg":"Prefetcher shutting down"}
--- FAIL: TestE2E_HTTP_Flow (11.08s)
    --- PASS: TestE2E_HTTP_Flow/HealthCheck (0.00s)
    --- PASS: TestE2E_HTTP_Flow/AuthMiddleware (0.00s)
    --- PASS: TestE2E_HTTP_Flow/EnqueueAndDequeue (5.01s)
    --- FAIL: TestE2E_HTTP_Flow/DLQ_Flow (1.05s)
=== RUN   TestStoreIntegration
{"level":"error","time":"2026-01-13T20:08:37.158+0100","caller":"buffer/buffer.go:171","msg":"Failed to get items from Redis list{error 26 0  redis: client is closed}","stacktrace":"mqueue/internal/buffer.(*RedisBuffer).GetItems\n\t/home/morah-paul/Desktop/mqueue/internal/buffer/buffer.go:171\nmqueue/internal/flusher.(*Flusher).flush\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:76\nmqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:68\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.158+0100","caller":"flusher/flusher.go:78","msg":"Failed to get items from buffer{error 26 0  get items from redis list: redis: client is closed}","stacktrace":"mqueue/internal/flusher.(*Flusher).flush\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:78\nmqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:68\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.158+0100","caller":"flusher/flusher.go:69","msg":"Flush failed{error 26 0  get items from buffer: get items from redis list: redis: client is closed} {namespace 15 0 default <nil>} {topic 15 0 delay <nil>}","stacktrace":"mqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:69\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.158+0100","caller":"buffer/buffer.go:171","msg":"Failed to get items from Redis list{error 26 0  redis: client is closed}","stacktrace":"mqueue/internal/buffer.(*RedisBuffer).GetItems\n\t/home/morah-paul/Desktop/mqueue/internal/buffer/buffer.go:171\nmqueue/internal/flusher.(*Flusher).flush\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:76\nmqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:68\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.158+0100","caller":"flusher/flusher.go:78","msg":"Failed to get items from buffer{error 26 0  get items from redis list: redis: client is closed}","stacktrace":"mqueue/internal/flusher.(*Flusher).flush\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:78\nmqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:68\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.158+0100","caller":"flusher/flusher.go:69","msg":"Flush failed{error 26 0  get items from buffer: get items from redis list: redis: client is closed} {namespace 15 0 default <nil>} {topic 15 0 recover <nil>}","stacktrace":"mqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:69\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.158+0100","caller":"buffer/buffer.go:171","msg":"Failed to get items from Redis list{error 26 0  redis: client is closed}","stacktrace":"mqueue/internal/buffer.(*RedisBuffer).GetItems\n\t/home/morah-paul/Desktop/mqueue/internal/buffer/buffer.go:171\nmqueue/internal/flusher.(*Flusher).flush\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:76\nmqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:68\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.158+0100","caller":"flusher/flusher.go:78","msg":"Failed to get items from buffer{error 26 0  get items from redis list: redis: client is closed}","stacktrace":"mqueue/internal/flusher.(*Flusher).flush\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:78\nmqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:68\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.158+0100","caller":"flusher/flusher.go:69","msg":"Flush failed{error 26 0  get items from buffer: get items from redis list: redis: client is closed} {namespace 15 0 default <nil>} {topic 15 0 redisq <nil>}","stacktrace":"mqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:69\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.158+0100","caller":"buffer/buffer.go:171","msg":"Failed to get items from Redis list{error 26 0  redis: client is closed}","stacktrace":"mqueue/internal/buffer.(*RedisBuffer).GetItems\n\t/home/morah-paul/Desktop/mqueue/internal/buffer/buffer.go:171\nmqueue/internal/flusher.(*Flusher).flush\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:76\nmqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:68\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.158+0100","caller":"flusher/flusher.go:78","msg":"Failed to get items from buffer{error 26 0  get items from redis list: redis: client is closed}","stacktrace":"mqueue/internal/flusher.(*Flusher).flush\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:78\nmqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:68\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.158+0100","caller":"flusher/flusher.go:69","msg":"Flush failed{error 26 0  get items from buffer: get items from redis list: redis: client is closed} {namespace 15 0 default <nil>} {topic 15 0 concurrent <nil>}","stacktrace":"mqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:69\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.158+0100","caller":"buffer/buffer.go:171","msg":"Failed to get items from Redis list{error 26 0  redis: client is closed}","stacktrace":"mqueue/internal/buffer.(*RedisBuffer).GetItems\n\t/home/morah-paul/Desktop/mqueue/internal/buffer/buffer.go:171\nmqueue/internal/flusher.(*Flusher).flush\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:76\nmqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:68\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.158+0100","caller":"flusher/flusher.go:78","msg":"Failed to get items from buffer{error 26 0  get items from redis list: redis: client is closed}","stacktrace":"mqueue/internal/flusher.(*Flusher).flush\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:78\nmqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:68\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.158+0100","caller":"flusher/flusher.go:69","msg":"Flush failed{error 26 0  get items from buffer: get items from redis list: redis: client is closed} {namespace 15 0 default <nil>} {topic 15 0 prio <nil>}","stacktrace":"mqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:69\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.158+0100","caller":"buffer/buffer.go:171","msg":"Failed to get items from Redis list{error 26 0  redis: client is closed}","stacktrace":"mqueue/internal/buffer.(*RedisBuffer).GetItems\n\t/home/morah-paul/Desktop/mqueue/internal/buffer/buffer.go:171\nmqueue/internal/flusher.(*Flusher).flush\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:76\nmqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:68\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.158+0100","caller":"flusher/flusher.go:78","msg":"Failed to get items from buffer{error 26 0  get items from redis list: redis: client is closed}","stacktrace":"mqueue/internal/flusher.(*Flusher).flush\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:78\nmqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:68\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.159+0100","caller":"flusher/flusher.go:69","msg":"Flush failed{error 26 0  get items from buffer: get items from redis list: redis: client is closed} {namespace 15 0 default <nil>} {topic 15 0 idemp <nil>}","stacktrace":"mqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:69\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.159+0100","caller":"buffer/buffer.go:171","msg":"Failed to get items from Redis list{error 26 0  redis: client is closed}","stacktrace":"mqueue/internal/buffer.(*RedisBuffer).GetItems\n\t/home/morah-paul/Desktop/mqueue/internal/buffer/buffer.go:171\nmqueue/internal/flusher.(*Flusher).flush\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:76\nmqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:68\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.159+0100","caller":"flusher/flusher.go:78","msg":"Failed to get items from buffer{error 26 0  get items from redis list: redis: client is closed}","stacktrace":"mqueue/internal/flusher.(*Flusher).flush\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:78\nmqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:68\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.159+0100","caller":"flusher/flusher.go:69","msg":"Flush failed{error 26 0  get items from buffer: get items from redis list: redis: client is closed} {namespace 15 0 default <nil>} {topic 15 0 timeout <nil>}","stacktrace":"mqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:69\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.160+0100","caller":"buffer/buffer.go:171","msg":"Failed to get items from Redis list{error 26 0  redis: client is closed}","stacktrace":"mqueue/internal/buffer.(*RedisBuffer).GetItems\n\t/home/morah-paul/Desktop/mqueue/internal/buffer/buffer.go:171\nmqueue/internal/flusher.(*Flusher).flush\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:76\nmqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:68\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.160+0100","caller":"flusher/flusher.go:78","msg":"Failed to get items from buffer{error 26 0  get items from redis list: redis: client is closed}","stacktrace":"mqueue/internal/flusher.(*Flusher).flush\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:78\nmqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:68\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"error","time":"2026-01-13T20:08:37.160+0100","caller":"flusher/flusher.go:69","msg":"Flush failed{error 26 0  get items from buffer: get items from redis list: redis: client is closed} {namespace 15 0 e2e <nil>} {topic 15 0 dlq-topic <nil>}","stacktrace":"mqueue/internal/flusher.(*Flusher).flushAll\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:69\nmqueue/internal/flusher.(*Flusher).Run\n\t/home/morah-paul/Desktop/mqueue/internal/flusher/flusher.go:51"}
{"level":"info","time":"2026-01-13T20:08:37.160+0100","caller":"flusher/flusher.go:52","msg":"Flusher shutdown complete"}
=== RUN   TestStoreIntegration/PriorityOrdering
{"level":"info","time":"2026-01-13T20:08:43.255+0100","caller":"flusher/flusher.go:103","msg":"Flushed items{count 11 3  <nil>}"}
=== RUN   TestStoreIntegration/DelayedDelivery
{"level":"info","time":"2026-01-13T20:08:46.254+0100","caller":"flusher/flusher.go:103","msg":"Flushed items{count 11 1  <nil>}"}
=== RUN   TestStoreIntegration/LeaseTimeoutRedelivery
{"level":"info","time":"2026-01-13T20:08:50.251+0100","caller":"flusher/flusher.go:103","msg":"Flushed items{count 11 1  <nil>}"}
=== RUN   TestStoreIntegration/ConcurrentWorkers
{"level":"info","time":"2026-01-13T20:08:57.259+0100","caller":"flusher/flusher.go:103","msg":"Flushed items{count 11 5  <nil>}"}
{"level":"info","time":"2026-01-13T20:08:57.278+0100","caller":"flusher/flusher.go:103","msg":"Flushed items{count 11 5  <nil>}"}
=== RUN   TestStoreIntegration/RedisReadyQueueServing
{"level":"info","time":"2026-01-13T20:09:02.252+0100","caller":"flusher/flusher.go:103","msg":"Flushed items{count 11 2  <nil>}"}
{"level":"info","time":"2026-01-13T20:09:02.255+0100","caller":"flusher/flusher.go:103","msg":"Flushed items{count 11 2  <nil>}"}
=== RUN   TestStoreIntegration/IdempotencyKey
{"level":"info","time":"2026-01-13T20:09:06.251+0100","caller":"flusher/flusher.go:103","msg":"Flushed items{count 11 1  <nil>}"}
{"level":"info","time":"2026-01-13T20:09:11.251+0100","caller":"flusher/flusher.go:103","msg":"Flushed items{count 11 1  <nil>}"}
{"level":"info","time":"2026-01-13T20:09:11.254+0100","caller":"flusher/flusher.go:103","msg":"Flushed items{count 11 1  <nil>}"}
=== RUN   TestStoreIntegration/WALRecovery
{"level":"error","time":"2026-01-13T20:09:15.319+0100","caller":"prefetch/redis_prefetch.go:92","msg":"Failed to lease items{error 26 0  lease items: sql: database is closed}","stacktrace":"mqueue/internal/prefetch.(*RedisPrefetcher).prefetch.func1\n\t/home/morah-paul/Desktop/mqueue/internal/prefetch/redis_prefetch.go:92\nmqueue/internal/prefetch.(*RedisPrefetcher).prefetch\n\t/home/morah-paul/Desktop/mqueue/internal/prefetch/redis_prefetch.go:124"}
{"level":"error","time":"2026-01-13T20:09:15.319+0100","caller":"prefetch/redis_prefetch.go:92","msg":"Failed to lease items{error 26 0  lease items: sql: database is closed}","stacktrace":"mqueue/internal/prefetch.(*RedisPrefetcher).prefetch.func1\n\t/home/morah-paul/Desktop/mqueue/internal/prefetch/redis_prefetch.go:92\nmqueue/internal/prefetch.(*RedisPrefetcher).prefetch\n\t/home/morah-paul/Desktop/mqueue/internal/prefetch/redis_prefetch.go:124"}
{"level":"error","time":"2026-01-13T20:09:15.319+0100","caller":"prefetch/redis_prefetch.go:92","msg":"Failed to lease items{error 26 0  lease items: sql: database is closed}","stacktrace":"mqueue/internal/prefetch.(*RedisPrefetcher).prefetch.func1\n\t/home/morah-paul/Desktop/mqueue/internal/prefetch/redis_prefetch.go:92\nmqueue/internal/prefetch.(*RedisPrefetcher).prefetch\n\t/home/morah-paul/Desktop/mqueue/internal/prefetch/redis_prefetch.go:124"}
{"level":"error","time":"2026-01-13T20:09:15.319+0100","caller":"prefetch/redis_prefetch.go:92","msg":"Failed to lease items{error 26 0  lease items: sql: database is closed}","stacktrace":"mqueue/internal/prefetch.(*RedisPrefetcher).prefetch.func1\n\t/home/morah-paul/Desktop/mqueue/internal/prefetch/redis_prefetch.go:92\nmqueue/internal/prefetch.(*RedisPrefetcher).prefetch\n\t/home/morah-paul/Desktop/mqueue/internal/prefetch/redis_prefetch.go:124"}
{"level":"error","time":"2026-01-13T20:09:15.319+0100","caller":"prefetch/redis_prefetch.go:92","msg":"Failed to lease items{error 26 0  lease items: sql: database is closed}","stacktrace":"mqueue/internal/prefetch.(*RedisPrefetcher).prefetch.func1\n\t/home/morah-paul/Desktop/mqueue/internal/prefetch/redis_prefetch.go:92\nmqueue/internal/prefetch.(*RedisPrefetcher).prefetch\n\t/home/morah-paul/Desktop/mqueue/internal/prefetch/redis_prefetch.go:124"}
{"level":"error","time":"2026-01-13T20:09:15.319+0100","caller":"prefetch/redis_prefetch.go:92","msg":"Failed to lease items{error 26 0  lease items: sql: database is closed}","stacktrace":"mqueue/internal/prefetch.(*RedisPrefetcher).prefetch.func1\n\t/home/morah-paul/Desktop/mqueue/internal/prefetch/redis_prefetch.go:92\nmqueue/internal/prefetch.(*RedisPrefetcher).prefetch\n\t/home/morah-paul/Desktop/mqueue/internal/prefetch/redis_prefetch.go:124"}
--- PASS: TestStoreIntegration (38.24s)
    --- PASS: TestStoreIntegration/PriorityOrdering (3.01s)
    --- PASS: TestStoreIntegration/DelayedDelivery (4.01s)
    --- PASS: TestStoreIntegration/LeaseTimeoutRedelivery (7.03s)
    --- PASS: TestStoreIntegration/ConcurrentWorkers (3.02s)
    --- PASS: TestStoreIntegration/RedisReadyQueueServing (4.00s)
    --- PASS: TestStoreIntegration/IdempotencyKey (10.00s)
    --- PASS: TestStoreIntegration/WALRecovery (0.08s)
FAIL
FAIL	mqueue/tests	49.366s
FAIL
